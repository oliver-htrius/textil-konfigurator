
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Textil-Konfigurator erweitert</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 20px;
    }
    #konfigurator {
      position: relative;
      width: 450px;
      height: 900px;
      margin: 0 auto;
      border: 1px solid #ccc;
      background-color: #fff;
    }
    .draggable {
      position: absolute;
      cursor: move;
      user-select: none;
    }
    .resize-handle {
      width: 10px;
      height: 10px;
      background: #000;
      position: absolute;
      bottom: 0;
      right: 0;
      cursor: se-resize;
    }
    .rotate-handle {
      width: 10px;
      height: 10px;
      background: red;
      position: absolute;
      top: -15px;
      left: 50%;
      transform: translateX(-50%);
      cursor: grab;
    }
    #controls {
      margin-top: 15px;
    }
    button, input[type="file"], select, input[type="color"] {
      margin: 5px;
      padding: 8px 12px;
      font-size: 14px;
    }
  </style>
</head>
<body>

<h2>Textil-Konfigurator (erweitert)</h2>
<div id="controls">
  <input type="file" id="fileInput" accept="image/*">
  <button onclick="addText()">Text hinzufügen</button>
  <input type="color" id="colorPicker" value="#000000">
  <select id="fontPicker">
    <option value="Arial">Arial</option>
    <option value="Verdana">Verdana</option>
    <option value="Courier New">Courier New</option>
    <option value="Georgia">Georgia</option>
  </select>
  <button onclick="saveAsImage()">Als Bild speichern</button>
</div>

<div id="konfigurator"></div>

<script>
  const container = document.getElementById('konfigurator');
  const colorPicker = document.getElementById('colorPicker');
  const fontPicker = document.getElementById('fontPicker');
  let selectedText = null;

  // Logo hochladen
  document.getElementById('fileInput').addEventListener('change', function (e) {
    const file = e.target.files[0];
    if (!file) return;

    const wrapper = document.createElement('div');
    wrapper.className = 'draggable';
    wrapper.style.width = '150px';
    wrapper.style.top = '300px';
    wrapper.style.left = '150px';

    const img = document.createElement('img');
    img.src = URL.createObjectURL(file);
    img.style.width = '100%';
    img.style.display = 'block';

    const resizeHandle = document.createElement('div');
    resizeHandle.className = 'resize-handle';

    const rotateHandle = document.createElement('div');
    rotateHandle.className = 'rotate-handle';

    wrapper.appendChild(img);
    wrapper.appendChild(resizeHandle);
    wrapper.appendChild(rotateHandle);
    container.appendChild(wrapper);

    makeDraggable(wrapper);
    makeResizable(wrapper, resizeHandle);
    makeRotatable(wrapper, rotateHandle);
  });

  // Text hinzufügen
  function addText() {
    const div = document.createElement('div');
    div.className = 'draggable';
    div.contentEditable = true;
    div.textContent = 'Text';
    div.style.fontSize = '24px';
    div.style.color = colorPicker.value;
    div.style.fontFamily = fontPicker.value;
    div.style.fontWeight = 'bold';
    div.style.left = '50px';
    div.style.top = '50px';
    container.appendChild(div);
    makeDraggable(div);

    div.addEventListener('click', () => {
      selectedText = div;
      colorPicker.value = rgbToHex(window.getComputedStyle(div).color);
      fontPicker.value = window.getComputedStyle(div).fontFamily.replace(/["']/g, "").split(',')[0];
    });
  }

  // Farbänderung & Schriftart
  colorPicker.addEventListener('input', () => {
    if (selectedText) {
      selectedText.style.color = colorPicker.value;
    }
  });

  fontPicker.addEventListener('change', () => {
    if (selectedText) {
      selectedText.style.fontFamily = fontPicker.value;
    }
  });

  function rgbToHex(rgb) {
    const result = rgb.match(/\d+/g).map(x => parseInt(x).toString(16).padStart(2, '0'));
    return "#" + result.join('');
  }

  // Drag-Funktion
  function makeDraggable(el) {
    let offsetX = 0, offsetY = 0, isDown = false;

    el.addEventListener('mousedown', function (e) {
      if (e.target.classList.contains('resize-handle') || e.target.classList.contains('rotate-handle')) return;
      isDown = true;
      offsetX = e.offsetX;
      offsetY = e.offsetY;
    });

    document.addEventListener('mousemove', function (e) {
      if (!isDown) return;
      const rect = container.getBoundingClientRect();
      el.style.left = (e.clientX - rect.left - offsetX) + 'px';
      el.style.top = (e.clientY - rect.top - offsetY) + 'px';
    });

    document.addEventListener('mouseup', function () {
      isDown = false;
    });
  }

  // Resize-Funktion
  function makeResizable(wrapper, handle) {
    let isResizing = false;
    handle.addEventListener('mousedown', function (e) {
      e.stopPropagation();
      isResizing = true;
    });

    document.addEventListener('mousemove', function (e) {
      if (!isResizing) return;
      const rect = wrapper.getBoundingClientRect();
      const newWidth = e.clientX - rect.left;
      const newHeight = e.clientY - rect.top;
      wrapper.style.width = newWidth + 'px';
      wrapper.style.height = newHeight + 'px';
    });

    document.addEventListener('mouseup', function () {
      isResizing = false;
    });
  }

  // Rotate-Funktion
  function makeRotatable(wrapper, handle) {
    let isRotating = false;
    let center = {};

    handle.addEventListener('mousedown', function (e) {
      e.stopPropagation();
      isRotating = true;
      const rect = wrapper.getBoundingClientRect();
      center = {
        x: rect.left + rect.width / 2,
        y: rect.top + rect.height / 2
      };
    });

    document.addEventListener('mousemove', function (e) {
      if (!isRotating) return;
      const dx = e.clientX - center.x;
      const dy = e.clientY - center.y;
      const angle = Math.atan2(dy, dx) * 180 / Math.PI;
      wrapper.style.transform = 'rotate(' + angle + 'deg)';
    });

    document.addEventListener('mouseup', function () {
      isRotating = false;
    });
  }

  // Export als Bild
  function saveAsImage() {
    html2canvas(container).then(canvas => {
      const link = document.createElement('a');
      link.download = 'textil-konfiguration.png';
      link.href = canvas.toDataURL();
      link.click();
    });
  }
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</body>
</html>
